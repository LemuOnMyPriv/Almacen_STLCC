@page "{id:int}"
@model Almacen_STLCC.Pages.Actas.ArchivosModel
@{
    ViewData["Title"] = $"Archivos del Acta {Model.Acta?.F01 ?? "N/A"}";
}
<link rel="stylesheet" href="~/css/actas/archivos.css" />

<div class="contenedor">
    <header class="header">
        <div>
            <h1><i class="fa-solid fa-paperclip"></i> Archivos del Acta</h1>
            <p>Numero de Acta: @(Model.Acta.Numero_Acta) </p>
            <p>Proveedor: @(Model.Acta?.Proveedor?.Nombre_Proveedor ?? "N/A")</p>
        </div>
        <a asp-page="/Actas/Index" class="btn-gradient-secondary"><i class="fa-solid fa-angle-left"></i> Volver a Actas</a>
    </header>

    @if (Model.Anexos != null && Model.Anexos.Any())
    {
        <section class="tabla-archivos">
            <div class="header-archivos">
                <h2>Archivos Adjuntos (@Model.Anexos.Count)</h2>
                <button type="button" class="btn-gradient-primary" onclick="mostrarFormulario()">
                    <i class="fa-solid fa-circle-plus"></i> Subir Nuevo Archivo
                </button>
            </div>

            <table class="tabla-gradient">
                <thead>
                    <tr>
                        <th>Nombre del Archivo</th>
                        <th>Formato</th>
                        <th>Peso</th>
                        <th>Fecha de Subida</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var anexo in Model.Anexos)
                    {
                        <tr>
                            <td>@anexo.Nombre_Archivo</td>
                            <td><span class="badge-gradient-warning">@anexo.Tipo_Archivo.ToUpper()</span></td>
                            <td>@anexo.Tamaño_Kb KB</td>
                            <td>@anexo.Fecha_Subida.ToString("dd/MM/yyyy")</td>
                            <td class="acciones-archivos">
                                <a asp-page-handler="Descargar"
                                   asp-route-id="@anexo.Id_Anexo"
                                   class="btn-gradient-info btn-gradient-sm"
                                   target="_blank">
                                    <i class="fa-solid fa-download"></i> Descargar
                                </a>
                                <button type="button"
                                        class="btn-gradient-danger btn-gradient-sm"
                                        onclick="confirmarEliminar(@anexo.Id_Anexo, '@anexo.Nombre_Archivo')">
                                    <i class="fa-solid fa-trash-can"></i> Eliminar
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </section>
    }
    else
    {
        <section class="sin-archivos">
            <div class="mensaje-vacio">
                <p><i class="fa-regular fa-folder-open"></i> Aún no hay archivos adjuntos.</p>
                <p>Si desea subir un archivo, <a href="javascript:void(0)" onclick="mostrarFormulario()" class="link-destacado">haga clic aquí</a></p>
            </div>
        </section>
    }

    <div id="formularioSubida" class="formulario-overlay" style="display: none;">
        <div class="formulario-container">
            <div class="formulario-header">
                <h3>Subir Archivos</h3>
                <button type="button" class="btn-cerrar-form" onclick="ocultarFormulario()">&times;</button>
            </div>

            <form method="post" enctype="multipart/form-data" id="formArchivo">
                <input type="hidden" name="IdActa" value="@(Model.Acta?.Id_Acta ?? 0)" />

                <div class="dropzone" id="dropzone" onclick="document.getElementById('inputArchivo').click()">
                    <div class="dropzone-content">
                        <p><i class="fa-solid fa-folder-open"></i> Haga clic aquí o arrastre sus archivos</p>
                        <p class="dropzone-subtitle">Puedes seleccionar múltiples archivos</p>
                        <input type="file"
                               id="inputArchivo"
                               name="Archivos"
                               accept=".jpg,.jpeg,.png,.pdf,.doc,.docx"
                               style="display: none;"
                               multiple
                               onchange="mostrarArchivosSeleccionados(this)" />
                        <div id="archivosSeleccionados" class="archivos-seleccionados"></div>
                        <small>Formatos permitidos: JPG, PNG, PDF, DOC, DOCX (máx. 10 MB por archivo)</small>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-gradient-success" onclick="validarYSubir()"><i class="fa-solid fa-floppy-disk"></i> Subir Archivos</button>
                    <button type="button" class="btn-gradient-secondary" onclick="ocultarFormulario()"><i class="fa-solid fa-ban"></i> Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <form id="formEliminar" method="post" asp-page-handler="Eliminar" style="display: none;">
        <input type="hidden" name="IdAnexo" id="idAnexoEliminar" />
    </form>
</div>
@if (TempData["SuccessMessage"] != null)
{
    <div id="successMessage" data-message="@TempData["SuccessMessage"]" style="display:none;"></div>
}

<script src="~/js/actas/archivos.js"></script>
@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            mostrarMensajeExito();
        });
    </script>
}
